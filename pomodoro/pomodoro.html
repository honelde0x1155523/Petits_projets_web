<!DOCTYPE html>
<html lang="fr">

<head>
	<meta charset="cp1252">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Suivi 8h–22h</title>
	<link rel="icon" href="favicon.ico" type="image/x-icon" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.4.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<style>
		html,
		body {
			height: 100%;
			margin: 0
		}

		body {
			background:
				linear-gradient(to bottom, rgba(160, 230, 255, 0.7), rgba(168, 230, 207, 0.7)),
				url("./Images/petit-palmier.jpg");
			background-size: cover;
			background-position: center;
			background-repeat: no-repeat;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.card {
			background: rgba(255, 255, 255, 0.6);
			border: 5px solid #ff7f11;
			border-radius: 5px;
			box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
			width: 90%;
			max-width: 400px;
			padding: 20px;
		}

		.big {
			font-size: 2.5rem;
		}

		.small {
			font-size: 0.9rem;
		}
	</style>
</head>

<body>
	<div class="card text-center">
		<div class="small mb-2">
			Heure de début : <strong>08h00</strong> — Heure de fin : <strong>22h00</strong>
		</div>
		<div id="nextHalfHour" class="big mb-3"></div>
		<div id="details" class="small"></div>
	</div>

	<script>
		//  # Données
		const H_START = 8, H_END = 22;

		//  # Fonctions utilitaires
		function formatTwoDigits(nombre) {
			return nombre < 10 ? '0' + nombre : nombre.toString();
		}

		function getClampedMinutes(date) {
			const total = (H_END - H_START) * 60;
			const passed = (date.getHours() - H_START) * 60 + date.getMinutes();
			return Math.max(0, Math.min(total, passed));
		}

		function getToNextHalf(date) {
			const minutes = date.getMinutes();
			return (minutes < 30 ? 30 : 60) - minutes;
		}

		//  # Ajout : Fonctions pour les nouvelles infos demandées
		function getHalfHourStart(date) {
			// Retourne l'heure de début de la demi-heure courante, formatée
			const hour = date.getHours();
			const minute = date.getMinutes() < 30 ? 0 : 30;
			return formatTwoDigits(hour) + 'h' + formatTwoDigits(minute);
		}

		function getHalfHourEnd(date) {
			// Retourne l'heure de fin de la demi-heure courante, formatée
			const hour = date.getHours();
			if (date.getMinutes() < 30) {
				return formatTwoDigits(hour) + 'h30';
			} else {
				return formatTwoDigits(hour + 1) + 'h00';
			}
		}

		function getMinutesSinceHalfHour(date) {
			// Minutes écoulées depuis début demi-heure
			return date.getMinutes() < 30 ? date.getMinutes() : date.getMinutes() - 30;
		}

		//  # Fonctions principales
		function updateDisplay() {
			const now = new Date();
			const passed = getClampedMinutes(now);
			const total = (H_END - H_START) * 60;
			const rem = total - passed;

			if (now.getHours() < H_START || now.getHours() >= H_END) {
				document.getElementById('nextHalfHour').textContent = 'Hors plage';
				document.getElementById('details').textContent = '';
				return;
			}

			document.getElementById('nextHalfHour').textContent =
				`${formatTwoDigits(getToNextHalf(now))} min avant demi-heure`;

			// Ajout des nouvelles infos
			const demiHeureDebut = getHalfHourStart(now);
			const demiHeureFin = getHalfHourEnd(now);
			const minutesDansDemiHeure = getMinutesSinceHalfHour(now);
			const tempsRestantDemiHeure = getToNextHalf(now);

			document.getElementById('details').innerHTML =
				`Demi-heures passées : ${Math.floor(passed / 30)}<br>` +
				`Temps passé : ${Math.floor(passed / 60)}h${formatTwoDigits(passed % 60)}<br>` +
				`Temps restant : ${Math.floor(rem / 60)}h${formatTwoDigits(rem % 60)}<br>` +
				`<hr style="margin:5px 0">` +
				`Demi-heure en cours : ${demiHeureDebut} à ${demiHeureFin}<br>` +
				`Temps écoulé depuis le début de cette demi-heure : ${minutesDansDemiHeure} min<br>` +
				`Temps restant dans cette demi-heure : ${tempsRestantDemiHeure} min`;
		}

		//  # Main
		function main() {
			document.addEventListener('DOMContentLoaded', () => {
				updateDisplay();
				setInterval(updateDisplay, 60000);
			});
		}

		//  # Lancement du programme
		main();

	</script>

</body>

</html>
